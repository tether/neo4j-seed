#!/usr/bin/env node

/**
 * Dependencies
 */

require('dotenv').config()
const seed = require('..')
const neo4j = require('neo4j-driver').v1
const join = require('path').join
const args = process.argv.slice(2)
const argv = require('minimist')(args)


/**
 * Create neo4j session driver.
 */

const driver = neo4j.driver(
  process.env.NEO4J_BOLT_URL || "bolt://localhost",
  neo4j.auth.basic(
    process.env.NEO4J_BOLT_USER || "neo4j",
    process.env.NEO4J_BOLT_PASSWORD || "neo4j"
  )
)

const session = driver.session()



if (argv.r) {
  session.run(`
    MATCH (n)
    DETACH DELETE n
  `).subscribe({
    onCompleted() {
      driver.close()
    }
  })
} else {
  const dir = argv._[0] || 'seed'
  seed(process.cwd() + '/' + dir)
}
